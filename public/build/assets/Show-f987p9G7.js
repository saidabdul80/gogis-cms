import{d as J,r as z,q as B,a as d,c as f,o as r,w as t,b as l,e as i,t as s,f as E,l as q,i as n,h as c,k as v,F as K,m as M}from"./app-C2hLAGXa.js";import{A as Q}from"./AdminLayout-j06L8c6A.js";import{C as X,p as Y,a as tt,b as et,B as lt,c as nt,L as at,d as st}from"./index-Cd6fHQZP.js";import"./useTheme-2fmPyRTJ.js";const ot={class:"d-flex justify-space-between align-center"},rt={class:"text-h4 font-weight-bold"},ut={class:"text-h3 font-weight-bold text-white"},it={class:"text-h3 font-weight-bold text-white"},dt={class:"text-h3 font-weight-bold text-white"},mt={key:0},ft={key:1,class:"text-grey"},yt={key:1,class:"text-grey"},pt={class:"d-flex justify-space-between align-center"},_t={key:0,class:"text-center py-8"},ct={key:1,class:"text-center py-8"},vt={key:2,class:"text-center py-8"},gt={key:3,style:{height:"400px"}},Nt=J({__name:"Show",props:{customer:{},properties:{},analytics:{}},setup(o){X.register(Y,tt,et,lt,nt,at);const k=o,w=z(k.properties[0]?.id||null),N=z([]),D=z(!1),T=B(()=>`${k.customer.first_name} ${k.customer.middle_name||""} ${k.customer.last_name}`.trim()),P=B(()=>k.properties.find(a=>a.id===w.value)),F=async a=>{D.value=!0;try{const e=await fetch(route("admin.individual-customers.property-payments",{individualCustomer:k.customer.id,property_id:a}));N.value=await e.json()}catch(e){console.error("Error fetching payment history:",e)}finally{D.value=!1}},G=a=>{w.value=a,F(a)};w.value&&F(w.value);const V=B(()=>N.value.length?{labels:N.value.map(a=>new Date(a.payment_date).toLocaleDateString()),datasets:[{label:"Payment Amount (₦)",data:N.value.map(a=>a.amount),backgroundColor:"rgba(28, 100, 52, 0.8)",borderColor:"rgba(28, 100, 52, 1)",borderWidth:1}]}:{labels:[],datasets:[]}),$={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:`Last 5 Payments - ${P.value?.payment_frequency||""}`}},scales:{y:{beginAtZero:!0,ticks:{callback:function(a){return"₦"+a.toLocaleString()}}}}},S=a=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN"}).format(a),H=a=>a?a.charAt(0).toUpperCase()+a.slice(1):"N/A",O=a=>{if(!a)return"grey";switch(a){case"PAID":return"success";case"PENDING":return"warning";case"PARTIAL":return"info";case"FAILED":return"error";case"CANCELLED":return"grey";default:return"grey"}};return(a,e)=>{const h=d("v-btn"),x=d("v-col"),I=d("v-row"),m=d("v-icon"),g=d("v-card-text"),b=d("v-card"),C=d("v-card-title"),y=d("v-list-item-title"),_=d("v-list-item-subtitle"),p=d("v-list-item"),j=d("v-list"),A=d("v-chip"),R=d("v-alert"),U=d("v-data-table"),W=d("v-progress-circular"),Z=d("v-container");return r(),f(Q,null,{default:t(()=>[l(Z,{fluid:""},{default:t(()=>[l(I,{class:"mb-4"},{default:t(()=>[l(x,{cols:"12"},{default:t(()=>[i("div",ot,[i("div",null,[i("h1",rt,s(T.value),1),e[1]||(e[1]=i("p",{class:"text-subtitle-1 text-grey"},"Individual Customer Profile",-1))]),i("div",null,[l(E(q),{href:a.route("admin.individual-customers.edit",o.customer.id)},{default:t(()=>[l(h,{color:"primary","prepend-icon":"mdi-pencil"},{default:t(()=>[...e[2]||(e[2]=[n(" Edit Customer ",-1)])]),_:1})]),_:1},8,["href"]),l(E(q),{href:a.route("admin.individual-customers.index"),class:"ml-2"},{default:t(()=>[l(h,{variant:"outlined"},{default:t(()=>[...e[3]||(e[3]=[n(" Back to List ",-1)])]),_:1})]),_:1},8,["href"])])])]),_:1})]),_:1}),l(I,{class:"mb-4"},{default:t(()=>[l(x,{cols:"12",md:"4"},{default:t(()=>[l(b,{color:"primary",dark:""},{default:t(()=>[l(g,null,{default:t(()=>[e[5]||(e[5]=i("div",{class:"text-overline text-white"},"Total Properties",-1)),i("div",ut,s(o.analytics.total_properties),1),l(m,{size:"48",class:"float-right mt-n8 text-white"},{default:t(()=>[...e[4]||(e[4]=[n("mdi-home-city",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(x,{cols:"12",md:"4"},{default:t(()=>[l(b,{color:"success",dark:""},{default:t(()=>[l(g,null,{default:t(()=>[e[7]||(e[7]=i("div",{class:"text-overline text-white"},"Total Paid Amount",-1)),i("div",it,s(S(o.analytics.total_paid_amount)),1),l(m,{size:"48",class:"float-right mt-n8 text-white"},{default:t(()=>[...e[6]||(e[6]=[n("mdi-cash-multiple",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(x,{cols:"12",md:"4"},{default:t(()=>[l(b,{color:"info",dark:""},{default:t(()=>[l(g,null,{default:t(()=>[e[9]||(e[9]=i("div",{class:"text-overline text-white"},"Property Types",-1)),i("div",dt,s(Object.keys(o.analytics.properties_by_type).length),1),l(m,{size:"48",class:"float-right mt-n8 text-white"},{default:t(()=>[...e[8]||(e[8]=[n("mdi-shape",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(I,null,{default:t(()=>[l(x,{cols:"12",md:"4"},{default:t(()=>[l(b,null,{default:t(()=>[l(C,null,{default:t(()=>[...e[10]||(e[10]=[n("Customer Information",-1)])]),_:1}),l(g,null,{default:t(()=>[l(j,{density:"compact"},{default:t(()=>[l(p,null,{prepend:t(()=>[l(m,null,{default:t(()=>[...e[11]||(e[11]=[n("mdi-account",-1)])]),_:1})]),default:t(()=>[l(y,null,{default:t(()=>[...e[12]||(e[12]=[n("Full Name",-1)])]),_:1}),l(_,null,{default:t(()=>[n(s(T.value),1)]),_:1})]),_:1}),o.customer.nin?(r(),f(p,{key:0},{prepend:t(()=>[l(m,null,{default:t(()=>[...e[13]||(e[13]=[n("mdi-card-account-details",-1)])]),_:1})]),default:t(()=>[l(y,null,{default:t(()=>[...e[14]||(e[14]=[n("NIN",-1)])]),_:1}),l(_,null,{default:t(()=>[n(s(o.customer.nin),1)]),_:1})]),_:1})):c("",!0),o.customer.gender?(r(),f(p,{key:1},{prepend:t(()=>[l(m,null,{default:t(()=>[...e[15]||(e[15]=[n("mdi-gender-male-female",-1)])]),_:1})]),default:t(()=>[l(y,null,{default:t(()=>[...e[16]||(e[16]=[n("Gender",-1)])]),_:1}),l(_,null,{default:t(()=>[n(s(o.customer.gender),1)]),_:1})]),_:1})):c("",!0),o.customer.dob?(r(),f(p,{key:2},{prepend:t(()=>[l(m,null,{default:t(()=>[...e[17]||(e[17]=[n("mdi-cake",-1)])]),_:1})]),default:t(()=>[l(y,null,{default:t(()=>[...e[18]||(e[18]=[n("Date of Birth",-1)])]),_:1}),l(_,null,{default:t(()=>[n(s(o.customer.dob),1)]),_:1})]),_:1})):c("",!0),o.customer.email?(r(),f(p,{key:3},{prepend:t(()=>[l(m,null,{default:t(()=>[...e[19]||(e[19]=[n("mdi-email",-1)])]),_:1})]),default:t(()=>[l(y,null,{default:t(()=>[...e[20]||(e[20]=[n("Email",-1)])]),_:1}),l(_,null,{default:t(()=>[n(s(o.customer.email),1)]),_:1})]),_:1})):c("",!0),o.customer.phone_number?(r(),f(p,{key:4},{prepend:t(()=>[l(m,null,{default:t(()=>[...e[21]||(e[21]=[n("mdi-phone",-1)])]),_:1})]),default:t(()=>[l(y,null,{default:t(()=>[...e[22]||(e[22]=[n("Phone",-1)])]),_:1}),l(_,null,{default:t(()=>[n(s(o.customer.phone_number),1)]),_:1})]),_:1})):c("",!0),o.customer.lga?(r(),f(p,{key:5},{prepend:t(()=>[l(m,null,{default:t(()=>[...e[23]||(e[23]=[n("mdi-map-marker",-1)])]),_:1})]),default:t(()=>[l(y,null,{default:t(()=>[...e[24]||(e[24]=[n("LGA",-1)])]),_:1}),l(_,null,{default:t(()=>[n(s(o.customer.lga.name),1)]),_:1})]),_:1})):c("",!0),o.customer.address?(r(),f(p,{key:6},{prepend:t(()=>[l(m,null,{default:t(()=>[...e[25]||(e[25]=[n("mdi-home",-1)])]),_:1})]),default:t(()=>[l(y,null,{default:t(()=>[...e[26]||(e[26]=[n("Address",-1)])]),_:1}),l(_,null,{default:t(()=>[n(s(o.customer.address),1)]),_:1})]),_:1})):c("",!0)]),_:1})]),_:1})]),_:1}),l(b,{class:"mt-4"},{default:t(()=>[l(C,null,{default:t(()=>[...e[27]||(e[27]=[n("Properties by Type",-1)])]),_:1}),l(g,null,{default:t(()=>[l(j,{density:"compact"},{default:t(()=>[(r(!0),v(K,null,M(o.analytics.properties_by_type,(u,L)=>(r(),f(p,{key:L},{append:t(()=>[l(A,{size:"small",color:"primary"},{default:t(()=>[n(s(u.count),1)]),_:2},1024)]),default:t(()=>[l(y,null,{default:t(()=>[n(s(L),1)]),_:2},1024),l(_,null,{default:t(()=>[n(" Total: "+s(S(u.total_amount)),1)]),_:2},1024)]),_:2},1024))),128)),Object.keys(o.analytics.properties_by_type).length===0?(r(),f(p,{key:0},{default:t(()=>[l(y,{class:"text-grey"},{default:t(()=>[...e[28]||(e[28]=[n("No properties yet",-1)])]),_:1})]),_:1})):c("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),l(x,{cols:"12",md:"8"},{default:t(()=>[l(b,{class:"mb-4"},{default:t(()=>[l(C,null,{default:t(()=>[...e[29]||(e[29]=[n("Properties & Last Invoice Due Date",-1)])]),_:1}),l(g,null,{default:t(()=>[l(U,{headers:[{title:"Property Number",key:"number_value"},{title:"Type",key:"property_type.name"},{title:"Address",key:"address"},{title:"Amount",key:"amount"},{title:"Frequency",key:"payment_frequency"},{title:"Last Invoice Due",key:"last_invoice_due_date"},{title:"Status",key:"last_invoice_status"}],items:o.properties,"items-per-page":10,class:"elevation-0","onClick:row":e[0]||(e[0]=(u,{item:L})=>G(L.id)),hover:""},{"item.number_value":t(({item:u})=>[i("strong",null,s(u.number_type)+"-"+s(u.number_value),1)]),"item.amount":t(({item:u})=>[n(s(S(u.amount)),1)]),"item.payment_frequency":t(({item:u})=>[l(A,{size:"small",color:"info"},{default:t(()=>[n(s(H(u.payment_frequency)),1)]),_:2},1024)]),"item.last_invoice_due_date":t(({item:u})=>[u.last_invoice_due_date?(r(),v("span",mt,s(new Date(u.last_invoice_due_date).toLocaleDateString()),1)):(r(),v("span",ft,"No invoice"))]),"item.last_invoice_status":t(({item:u})=>[u.last_invoice_status?(r(),f(A,{key:0,size:"small",color:O(u.last_invoice_status)},{default:t(()=>[n(s(u.last_invoice_status),1)]),_:2},1032,["color"])):(r(),v("span",yt,"-"))]),"no-data":t(()=>[l(R,{type:"info",variant:"tonal",class:"my-4"},{default:t(()=>[...e[30]||(e[30]=[n(" No properties found for this customer. ",-1)])]),_:1})]),_:1},8,["items"])]),_:1})]),_:1}),l(b,null,{default:t(()=>[l(C,null,{default:t(()=>[i("div",pt,[e[31]||(e[31]=i("span",null,"Payment History",-1)),P.value?(r(),f(A,{key:0,color:"primary",size:"small"},{default:t(()=>[n(s(P.value.number_type)+"-"+s(P.value.number_value),1)]),_:1})):c("",!0)])]),_:1}),l(g,null,{default:t(()=>[D.value?(r(),v("div",_t,[l(W,{indeterminate:"",color:"primary"}),e[32]||(e[32]=i("p",{class:"mt-4 text-grey"},"Loading payment history...",-1))])):w.value?N.value.length===0?(r(),v("div",vt,[l(m,{size:"64",color:"grey"},{default:t(()=>[...e[35]||(e[35]=[n("mdi-cash-remove",-1)])]),_:1}),e[36]||(e[36]=i("p",{class:"mt-4 text-grey"},"No payment history for this property",-1))])):(r(),v("div",gt,[l(E(st),{data:V.value,options:$},null,8,["data"])])):(r(),v("div",ct,[l(m,{size:"64",color:"grey"},{default:t(()=>[...e[33]||(e[33]=[n("mdi-chart-bar",-1)])]),_:1}),e[34]||(e[34]=i("p",{class:"mt-4 text-grey"},"Select a property to view payment history",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}});export{Nt as default};
