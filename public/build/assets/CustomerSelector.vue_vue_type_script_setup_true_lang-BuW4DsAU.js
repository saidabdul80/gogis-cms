import{d as Y,H as Z,r as g,q as Q,p as ee,a as n,k as M,o as _,b as l,w as t,c as k,h as U,i as f,t as N,E as le,G as ae,g as te}from"./app-Ckp5YMnG.js";const oe={key:0},re=Y({__name:"CustomerSelector",props:{modelValue:{},label:{default:"Select Customer"},required:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(q,{emit:P}){const R=q,$=P,h=Z(),s=g(""),b=g(!1),V=g([]),y=g(!1),C=g("individual"),a=g({first_name:"",middle_name:"",last_name:"",nin:"",gender:"",dob:"",lga_id:null,name:"",category:"",registration_number:"",registered_date:"",email:"",phone_number:"",address:""}),S=Q({get:()=>R.modelValue,set:r=>$("update:modelValue",r??null)}),A=async r=>{if(!r||r.length<2){V.value=[];return}b.value=!0;try{const u=await(await fetch(`/admin/customers/search?q=${encodeURIComponent(r)}`)).json();V.value=u}catch(e){console.error("Error fetching customers:",e),V.value=[]}finally{b.value=!1}};ee(s,r=>{r&&r.length>=2?A(r):V.value=[]});const E=r=>{C.value=r,y.value=!0,T()},T=()=>{a.value={first_name:"",middle_name:"",last_name:"",nin:"",gender:"",dob:"",lga_id:null,name:"",category:"",registration_number:"",registered_date:"",email:"",phone_number:"",address:""}},O=async()=>{const r=C.value==="individual"?"/admin/individual-customers":"/admin/corporate-customers",e=C.value==="individual"?{first_name:a.value.first_name,middle_name:a.value.middle_name,last_name:a.value.last_name,nin:a.value.nin,gender:a.value.gender,dob:a.value.dob,lga_id:a.value.lga_id,email:a.value.email,phone_number:a.value.phone_number,address:a.value.address}:{name:a.value.name,category:a.value.category,registration_number:a.value.registration_number,registered_date:a.value.registered_date,email:a.value.email,phone_number:a.value.phone_number,address:a.value.address};try{b.value=!0;const u=h.props.csrf_token,i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":u,"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",body:JSON.stringify(e)});if(!i.ok){let v=`Server returned ${i.status}`;try{const c=await i.json();console.error("Server error:",i.status,c),c.errors?v=Object.values(c.errors).flat().join(`
`):c.message&&(v=c.message)}catch{const w=await i.text();console.error("Server error (text):",i.status,w),v=w||v}throw new Error(v)}const m=await i.json();if(m.success&&m.customer)S.value=m.customer,y.value=!1,T();else throw console.error("Unexpected response format:",m),new Error("Invalid response from server")}catch(u){console.error("Error creating customer:",u),alert(`Failed to create customer:
${u.message||"Please check the form and try again."}`)}finally{b.value=!1}},B=["Male","Female"],F=["Company","Hotel","Bank","Hospital","School","MDAs","Others"];return(r,e)=>{const u=n("v-icon"),i=n("v-list-item-subtitle"),m=n("v-list-item"),v=n("v-list-item-title"),c=n("v-divider"),w=n("v-list"),H=n("v-autocomplete"),X=n("v-card-title"),p=n("v-text-field"),d=n("v-col"),D=n("v-select"),j=n("v-row"),G=n("v-form"),L=n("v-card-text"),z=n("v-spacer"),I=n("v-btn"),J=n("v-card-actions"),K=n("v-card"),W=n("v-dialog");return _(),M("div",null,[l(H,{variant:"outlined",modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=o=>S.value=o),search:s.value,"onUpdate:search":e[3]||(e[3]=o=>s.value=o),items:V.value,loading:b.value,label:q.label,required:q.required,"item-title":"name","item-value":"id","return-object":"",clearable:"","no-filter":""},{item:t(({props:o,item:x})=>[l(m,le(ae(o)),{prepend:t(()=>[l(u,{icon:x.raw.type==="individual"?"mdi-account":"mdi-domain"},null,8,["icon"])]),default:t(()=>[l(i,null,{default:t(()=>[f(N(x.raw.type==="individual"?"Individual":"Corporate")+" ",1),x.raw.phone_number?(_(),M("span",oe," â€¢ "+N(x.raw.phone_number),1)):U("",!0)]),_:2},1024)]),_:2},1040)]),"no-data":t(()=>[l(w,null,{default:t(()=>[l(m,null,{default:t(()=>[l(v,{class:"text-center text-grey"},{default:t(()=>[f(N(s.value&&s.value.length>=2?"No customers found":"Type to search customers"),1)]),_:1})]),_:1}),s.value&&s.value.length>=2?(_(),k(c,{key:0})):U("",!0),s.value&&s.value.length>=2?(_(),k(m,{key:1,onClick:e[0]||(e[0]=o=>E("individual")),class:"text-primary"},{prepend:t(()=>[l(u,{icon:"mdi-plus-circle",color:"primary"})]),default:t(()=>[l(v,null,{default:t(()=>[...e[16]||(e[16]=[f("Add Individual Customer",-1)])]),_:1})]),_:1})):U("",!0),s.value&&s.value.length>=2?(_(),k(m,{key:2,onClick:e[1]||(e[1]=o=>E("corporate")),class:"text-primary"},{prepend:t(()=>[l(u,{icon:"mdi-plus-circle",color:"primary"})]),default:t(()=>[l(v,null,{default:t(()=>[...e[17]||(e[17]=[f("Add Corporate Customer",-1)])]),_:1})]),_:1})):U("",!0)]),_:1})]),_:1},8,["modelValue","search","items","loading","label","required"]),l(W,{modelValue:y.value,"onUpdate:modelValue":e[15]||(e[15]=o=>y.value=o),"max-width":"600"},{default:t(()=>[l(K,null,{default:t(()=>[l(X,null,{default:t(()=>[f(" Add "+N(C.value==="individual"?"Individual":"Corporate")+" Customer ",1)]),_:1}),l(L,null,{default:t(()=>[l(G,{onSubmit:te(O,["prevent"])},{default:t(()=>[C.value==="individual"?(_(),k(j,{key:0},{default:t(()=>[l(d,{cols:"12",md:"4"},{default:t(()=>[l(p,{modelValue:a.value.first_name,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.first_name=o),label:"First Name *",required:""},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"4"},{default:t(()=>[l(p,{modelValue:a.value.middle_name,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.middle_name=o),label:"Middle Name"},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"4"},{default:t(()=>[l(p,{modelValue:a.value.last_name,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.last_name=o),label:"Last Name *",required:""},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"6"},{default:t(()=>[l(p,{modelValue:a.value.nin,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.nin=o),label:"NIN"},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"6"},{default:t(()=>[l(D,{modelValue:a.value.gender,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.gender=o),items:B,label:"Gender"},null,8,["modelValue"])]),_:1})]),_:1})):(_(),k(j,{key:1},{default:t(()=>[l(d,{cols:"12"},{default:t(()=>[l(p,{modelValue:a.value.name,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.name=o),label:"Company Name *",required:""},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"6"},{default:t(()=>[l(D,{modelValue:a.value.category,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.category=o),items:F,label:"Category"},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"6"},{default:t(()=>[l(p,{modelValue:a.value.registration_number,"onUpdate:modelValue":e[11]||(e[11]=o=>a.value.registration_number=o),label:"Registration Number *",required:""},null,8,["modelValue"])]),_:1})]),_:1})),l(j,null,{default:t(()=>[l(d,{cols:"12",md:"6"},{default:t(()=>[l(p,{modelValue:a.value.email,"onUpdate:modelValue":e[12]||(e[12]=o=>a.value.email=o),label:"Email",type:"email"},null,8,["modelValue"])]),_:1}),l(d,{cols:"12",md:"6"},{default:t(()=>[l(p,{modelValue:a.value.phone_number,"onUpdate:modelValue":e[13]||(e[13]=o=>a.value.phone_number=o),label:"Phone Number"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(J,null,{default:t(()=>[l(z),l(I,{onClick:e[14]||(e[14]=o=>y.value=!1)},{default:t(()=>[...e[18]||(e[18]=[f("Cancel",-1)])]),_:1}),l(I,{color:"primary",onClick:O},{default:t(()=>[...e[19]||(e[19]=[f("Create",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});export{re as _};
