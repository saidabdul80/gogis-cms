import{d as J,r as z,q as E,a as d,c as p,o as r,w as t,b as l,e as i,t as n,f as B,l as q,i as o,h as k,k as y,F as K,m as M}from"./app-C2hLAGXa.js";import{A as Q}from"./AdminLayout-j06L8c6A.js";import{C as X,p as Y,a as tt,b as et,B as lt,c as ot,L as at,d as nt}from"./index-Cd6fHQZP.js";import"./useTheme-2fmPyRTJ.js";const st={class:"d-flex justify-space-between align-center"},rt={class:"text-h4 font-weight-bold"},it={class:"text-h3 font-weight-bold text-white"},ut={class:"text-h3 font-weight-bold text-white"},dt={class:"text-h3 font-weight-bold text-white"},mt={key:0},pt={key:1,class:"text-grey"},yt={key:1,class:"text-grey"},ct={class:"d-flex justify-space-between align-center"},ft={key:0,class:"text-center py-8"},_t={key:1,class:"text-center py-8"},vt={key:2,class:"text-center py-8"},gt={key:3,style:{height:"400px"}},Ct=J({__name:"Show",props:{customer:{},properties:{},analytics:{}},setup(u){X.register(Y,tt,et,lt,ot,at);const C=u,x=z(C.properties[0]?.id||null),w=z([]),L=z(!1),I=E(()=>C.customer.company_name),P=E(()=>C.properties.find(a=>a.id===x.value)),T=async a=>{L.value=!0;try{const e=await fetch(route("admin.corporate-customers.property-payments",{corporateCustomer:C.customer.id,property_id:a}));w.value=await e.json()}catch(e){console.error("Error fetching payment history:",e)}finally{L.value=!1}},V=a=>{x.value=a,T(a)};x.value&&T(x.value);const G=E(()=>w.value.length?{labels:w.value.map(a=>new Date(a.payment_date).toLocaleDateString()),datasets:[{label:"Payment Amount (₦)",data:w.value.map(a=>a.amount),backgroundColor:"rgba(28, 100, 52, 0.8)",borderColor:"rgba(28, 100, 52, 1)",borderWidth:1}]}:{labels:[],datasets:[]}),H={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top"},title:{display:!0,text:`Last 5 Payments - ${P.value?.payment_frequency||""}`}},scales:{y:{beginAtZero:!0,ticks:{callback:function(a){return"₦"+a.toLocaleString()}}}}},D=a=>new Intl.NumberFormat("en-NG",{style:"currency",currency:"NGN"}).format(a),O=a=>a?a.charAt(0).toUpperCase()+a.slice(1):"N/A",R=a=>{if(!a)return"grey";switch(a){case"PAID":return"success";case"PENDING":return"warning";case"PARTIAL":return"info";case"FAILED":return"error";case"CANCELLED":return"grey";default:return"grey"}};return(a,e)=>{const F=d("v-btn"),g=d("v-col"),S=d("v-row"),m=d("v-icon"),c=d("v-card-text"),f=d("v-card"),N=d("v-card-title"),_=d("v-list-item-title"),b=d("v-list-item-subtitle"),v=d("v-list-item"),j=d("v-list"),h=d("v-chip"),U=d("v-alert"),W=d("v-data-table"),Z=d("v-progress-circular"),$=d("v-container");return r(),p(Q,null,{default:t(()=>[l($,{fluid:""},{default:t(()=>[l(S,{class:"mb-4"},{default:t(()=>[l(g,{cols:"12"},{default:t(()=>[i("div",st,[i("div",null,[i("h1",rt,n(I.value),1),e[1]||(e[1]=i("p",{class:"text-subtitle-1 text-grey"},"Corporate Customer Profile",-1))]),i("div",null,[l(B(q),{href:a.route("admin.corporate-customers.edit",u.customer.id)},{default:t(()=>[l(F,{color:"primary","prepend-icon":"mdi-pencil"},{default:t(()=>[...e[2]||(e[2]=[o(" Edit Customer ",-1)])]),_:1})]),_:1},8,["href"]),l(B(q),{href:a.route("admin.corporate-customers.index"),class:"ml-2"},{default:t(()=>[l(F,{variant:"outlined"},{default:t(()=>[...e[3]||(e[3]=[o(" Back to List ",-1)])]),_:1})]),_:1},8,["href"])])])]),_:1})]),_:1}),l(S,{class:"mb-4"},{default:t(()=>[l(g,{cols:"12",md:"4"},{default:t(()=>[l(f,{color:"primary",dark:""},{default:t(()=>[l(c,null,{default:t(()=>[e[5]||(e[5]=i("div",{class:"text-overline text-white"},"Total Properties",-1)),i("div",it,n(u.analytics.total_properties),1),l(m,{size:"48",class:"float-right mt-n8 text-white"},{default:t(()=>[...e[4]||(e[4]=[o("mdi-home-city",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(g,{cols:"12",md:"4"},{default:t(()=>[l(f,{color:"success",dark:""},{default:t(()=>[l(c,null,{default:t(()=>[e[7]||(e[7]=i("div",{class:"text-overline text-white"},"Total Paid Amount",-1)),i("div",ut,n(D(u.analytics.total_paid_amount)),1),l(m,{size:"48",class:"float-right mt-n8 text-white"},{default:t(()=>[...e[6]||(e[6]=[o("mdi-cash-multiple",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(g,{cols:"12",md:"4"},{default:t(()=>[l(f,{color:"info",dark:""},{default:t(()=>[l(c,null,{default:t(()=>[e[9]||(e[9]=i("div",{class:"text-overline text-white"},"Property Types",-1)),i("div",dt,n(Object.keys(u.analytics.properties_by_type).length),1),l(m,{size:"48",class:"float-right mt-n8 text-white"},{default:t(()=>[...e[8]||(e[8]=[o("mdi-shape",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(S,null,{default:t(()=>[l(g,{cols:"12",md:"4"},{default:t(()=>[l(f,null,{default:t(()=>[l(N,null,{default:t(()=>[...e[10]||(e[10]=[o("Customer Information",-1)])]),_:1}),l(c,null,{default:t(()=>[l(j,{density:"compact"},{default:t(()=>[l(v,null,{prepend:t(()=>[l(m,null,{default:t(()=>[...e[11]||(e[11]=[o("mdi-office-building",-1)])]),_:1})]),default:t(()=>[l(_,null,{default:t(()=>[...e[12]||(e[12]=[o("Company Name",-1)])]),_:1}),l(b,null,{default:t(()=>[o(n(I.value),1)]),_:1})]),_:1}),u.customer.category?(r(),p(v,{key:0},{prepend:t(()=>[l(m,null,{default:t(()=>[...e[13]||(e[13]=[o("mdi-tag",-1)])]),_:1})]),default:t(()=>[l(_,null,{default:t(()=>[...e[14]||(e[14]=[o("Category",-1)])]),_:1}),l(b,null,{default:t(()=>[o(n(u.customer.category),1)]),_:1})]),_:1})):k("",!0),u.customer.email?(r(),p(v,{key:1},{prepend:t(()=>[l(m,null,{default:t(()=>[...e[15]||(e[15]=[o("mdi-email",-1)])]),_:1})]),default:t(()=>[l(_,null,{default:t(()=>[...e[16]||(e[16]=[o("Email",-1)])]),_:1}),l(b,null,{default:t(()=>[o(n(u.customer.email),1)]),_:1})]),_:1})):k("",!0),u.customer.phone_number?(r(),p(v,{key:2},{prepend:t(()=>[l(m,null,{default:t(()=>[...e[17]||(e[17]=[o("mdi-phone",-1)])]),_:1})]),default:t(()=>[l(_,null,{default:t(()=>[...e[18]||(e[18]=[o("Phone",-1)])]),_:1}),l(b,null,{default:t(()=>[o(n(u.customer.phone_number),1)]),_:1})]),_:1})):k("",!0),u.customer.address?(r(),p(v,{key:3},{prepend:t(()=>[l(m,null,{default:t(()=>[...e[19]||(e[19]=[o("mdi-home",-1)])]),_:1})]),default:t(()=>[l(_,null,{default:t(()=>[...e[20]||(e[20]=[o("Address",-1)])]),_:1}),l(b,null,{default:t(()=>[o(n(u.customer.address),1)]),_:1})]),_:1})):k("",!0)]),_:1})]),_:1})]),_:1}),l(f,{class:"mt-4"},{default:t(()=>[l(N,null,{default:t(()=>[...e[21]||(e[21]=[o("Properties by Type",-1)])]),_:1}),l(c,null,{default:t(()=>[l(j,{density:"compact"},{default:t(()=>[(r(!0),y(K,null,M(u.analytics.properties_by_type,(s,A)=>(r(),p(v,{key:A},{append:t(()=>[l(h,{size:"small",color:"primary"},{default:t(()=>[o(n(s.count),1)]),_:2},1024)]),default:t(()=>[l(_,null,{default:t(()=>[o(n(A),1)]),_:2},1024),l(b,null,{default:t(()=>[o(" Total: "+n(D(s.total_amount)),1)]),_:2},1024)]),_:2},1024))),128)),Object.keys(u.analytics.properties_by_type).length===0?(r(),p(v,{key:0},{default:t(()=>[l(_,{class:"text-grey"},{default:t(()=>[...e[22]||(e[22]=[o("No properties yet",-1)])]),_:1})]),_:1})):k("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),l(g,{cols:"12",md:"8"},{default:t(()=>[l(f,{class:"mb-4"},{default:t(()=>[l(N,null,{default:t(()=>[...e[23]||(e[23]=[o("Properties & Last Invoice Due Date",-1)])]),_:1}),l(c,null,{default:t(()=>[l(W,{headers:[{title:"Property Number",key:"number_value"},{title:"Type",key:"property_type.name"},{title:"Address",key:"address"},{title:"Amount",key:"amount"},{title:"Frequency",key:"payment_frequency"},{title:"Last Invoice Due",key:"last_invoice_due_date"},{title:"Status",key:"last_invoice_status"}],items:u.properties,"items-per-page":10,class:"elevation-0","onClick:row":e[0]||(e[0]=(s,{item:A})=>V(A.id)),hover:""},{"item.number_value":t(({item:s})=>[i("strong",null,n(s.number_type)+"-"+n(s.number_value),1)]),"item.amount":t(({item:s})=>[o(n(D(s.amount)),1)]),"item.payment_frequency":t(({item:s})=>[l(h,{size:"small",color:"info"},{default:t(()=>[o(n(O(s.payment_frequency)),1)]),_:2},1024)]),"item.last_invoice_due_date":t(({item:s})=>[s.last_invoice_due_date?(r(),y("span",mt,n(new Date(s.last_invoice_due_date).toLocaleDateString()),1)):(r(),y("span",pt,"No invoice"))]),"item.last_invoice_status":t(({item:s})=>[s.last_invoice_status?(r(),p(h,{key:0,size:"small",color:R(s.last_invoice_status)},{default:t(()=>[o(n(s.last_invoice_status),1)]),_:2},1032,["color"])):(r(),y("span",yt,"-"))]),"no-data":t(()=>[l(U,{type:"info",variant:"tonal",class:"my-4"},{default:t(()=>[...e[24]||(e[24]=[o(" No properties found for this customer. ",-1)])]),_:1})]),_:1},8,["items"])]),_:1})]),_:1}),l(f,null,{default:t(()=>[l(N,null,{default:t(()=>[i("div",ct,[e[25]||(e[25]=i("span",null,"Payment History",-1)),P.value?(r(),p(h,{key:0,color:"primary",size:"small"},{default:t(()=>[o(n(P.value.number_type)+"-"+n(P.value.number_value),1)]),_:1})):k("",!0)])]),_:1}),l(c,null,{default:t(()=>[L.value?(r(),y("div",ft,[l(Z,{indeterminate:"",color:"primary"}),e[26]||(e[26]=i("p",{class:"mt-4 text-grey"},"Loading payment history...",-1))])):x.value?w.value.length===0?(r(),y("div",vt,[l(m,{size:"64",color:"grey"},{default:t(()=>[...e[29]||(e[29]=[o("mdi-cash-remove",-1)])]),_:1}),e[30]||(e[30]=i("p",{class:"mt-4 text-grey"},"No payment history for this property",-1))])):(r(),y("div",gt,[l(B(nt),{data:G.value,options:H},null,8,["data"])])):(r(),y("div",_t,[l(m,{size:"64",color:"grey"},{default:t(()=>[...e[27]||(e[27]=[o("mdi-chart-bar",-1)])]),_:1}),e[28]||(e[28]=i("p",{class:"mt-4 text-grey"},"Select a property to view payment history",-1))]))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}});export{Ct as default};
