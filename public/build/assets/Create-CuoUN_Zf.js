import{d as H,u as Q,r as F,p as X,q as Z,a as i,c as _,o as v,w as t,b as a,e as y,i as k,g as h,k as ee,h as G,f as r,E as te,G as ae,t as b,F as le,m as oe,n as C}from"./app-Ckp5YMnG.js";import{A as ne}from"./AdminLayout-DTcn9miB.js";import"./useTheme-B1awz47X.js";const re={class:"text-caption"},se={class:"text-body-1"},ie={class:"text-body-1"},ue={class:"text-body-1 text-capitalize"},ce=H({__name:"Create",props:{properties:{},selectedProperty:{},girasConfig:{}},setup(I){const d=I,M=()=>{if(d.girasConfig?.variables){const n={...d.girasConfig.variables};if(d.selectedProperty){const e=Object.keys(n)[0];e&&(n[e]=d.selectedProperty.amount)}return n}return{}},l=Q({property_id:d.selectedProperty?.id||null,amount:d.selectedProperty?.amount||0,due_date:"",description:"",sync_with_giras:!0,giras_gateway:"paystack",giras_variables:M()}),c=F(d.selectedProperty||null),p=F(!1),f=F(null),q=()=>{if(!(!d.girasConfig?.template||!l.giras_variables))try{let n=d.girasConfig.template;for(const[u,V]of Object.entries(l.giras_variables))n=n.replace(new RegExp(`{${u}}`,"g"),String(V||0));const e=new Function(`return ${n}`)();l.amount=Number(e)}catch(n){console.error("Failed to calculate amount from template:",n)}};X(()=>l.giras_variables,()=>{q()},{deep:!0});const g=Z(()=>{if(!l.due_date)return"";const n=new Date(l.due_date),e=c.value?.payment_frequency;return e==="monthly"?n.toLocaleDateString("en-US",{month:"long",year:"numeric"}):e==="yearly"?n.getFullYear().toString():n.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}),R=n=>`${n.number_type}: ${n.number_value} - ${n.address}`,Y=n=>{const e=d.properties.find(u=>u.id===n);if(e){if(c.value=e,l.amount=e.amount,l.description=`Invoice for ${e.number_type}: ${e.number_value}`,d.girasConfig?.variables){const u=Object.keys(d.girasConfig.variables);l.giras_variables={...d.girasConfig.variables},u.length>0&&(l.giras_variables[u[0]]=e.amount),q()}else l.amount=e.amount;l.due_date="",f.value=null}},A=n=>{if(n){const e=n.getFullYear(),u=String(n.getMonth()+1).padStart(2,"0"),V=String(n.getDate()).padStart(2,"0");l.due_date=`${e}-${u}-${V}`,p.value=!1}},z=n=>{if(n){const e=n.getFullYear(),u=String(n.getMonth()+1).padStart(2,"0");l.due_date=`${e}-${u}-01`,p.value=!1}},B=n=>{if(n){const e=n.getFullYear();l.due_date=`${e}-01-01`,p.value=!1}},j=()=>{l.post(route("admin.invoices.store"),{preserveScroll:!0})};return(n,e)=>{const u=i("v-btn"),V=i("v-card-title"),E=i("v-list-item"),L=i("v-autocomplete"),m=i("v-col"),w=i("v-text-field"),S=i("v-date-picker"),x=i("v-menu"),T=i("v-textarea"),O=i("v-icon"),J=i("v-switch"),K=i("v-select"),U=i("v-row"),D=i("v-card-text"),P=i("v-card"),N=i("v-form"),W=i("v-container");return v(),_(ne,null,{default:t(()=>[a(W,{fluid:""},{default:t(()=>[a(U,null,{default:t(()=>[a(m,{cols:"12"},{default:t(()=>[a(P,null,{default:t(()=>[a(V,{class:"d-flex justify-space-between align-center"},{default:t(()=>[e[20]||(e[20]=y("span",null,"Create Invoice",-1)),a(u,{variant:"text","prepend-icon":"mdi-arrow-left",onClick:e[0]||(e[0]=o=>n.$inertia.visit(n.route("admin.invoices.index")))},{default:t(()=>[...e[19]||(e[19]=[k(" Back to Invoices ",-1)])]),_:1})]),_:1}),a(D,null,{default:t(()=>[a(N,{onSubmit:h(j,["prevent"])},{default:t(()=>[a(U,null,{default:t(()=>[a(m,{cols:"12",md:"6"},{default:t(()=>[a(L,{modelValue:r(l).property_id,"onUpdate:modelValue":[e[1]||(e[1]=o=>r(l).property_id=o),Y],label:"Select Property *",items:I.properties,"item-title":R,"item-value":"id",variant:"outlined",density:"comfortable","error-messages":r(l).errors.property_id},{item:t(({props:o,item:s})=>[a(E,te(ae(o)),{title:t(()=>[y("strong",null,b(s.raw.number_type)+": "+b(s.raw.number_value),1)]),subtitle:t(()=>[y("div",null,b(s.raw.address),1),y("div",re,b(s.raw.property_type)+" | "+b(s.raw.customer.name),1)]),_:2},1040)]),_:1},8,["modelValue","items","error-messages"])]),_:1}),(v(!0),ee(le,null,oe(r(l).giras_variables,(o,s)=>(v(),_(m,{cols:"12",md:"6",key:String(s)},{default:t(()=>[a(w,{modelValue:r(l).giras_variables[s],"onUpdate:modelValue":$=>r(l).giras_variables[s]=$,modelModifiers:{number:!0},label:`${String(s).replace(/_/g," ").replace(/\b\w/g,$=>$.toUpperCase())} (â‚¦) *`,type:"number",step:"0.01",min:"0",variant:"outlined",density:"comfortable","error-messages":r(l).errors[`giras_variables.${s}`]},null,8,["modelValue","onUpdate:modelValue","label","error-messages"])]),_:2},1024))),128)),a(m,{cols:"12",md:"6"},{default:t(()=>[c.value?.payment_frequency==="daily"?(v(),_(x,{key:0,modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=o=>p.value=o),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:o})=>[a(w,C({modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=s=>g.value=s),label:"Due Date (Daily) *","prepend-inner-icon":"mdi-calendar",readonly:"",variant:"outlined",density:"comfortable"},o,{"error-messages":r(l).errors.due_date,hint:"Select specific date","persistent-hint":""}),null,16,["modelValue","error-messages"])]),default:t(()=>[a(S,{modelValue:f.value,"onUpdate:modelValue":[e[3]||(e[3]=o=>f.value=o),A]},null,8,["modelValue"])]),_:1},8,["modelValue"])):c.value?.payment_frequency==="weekly"?(v(),_(x,{key:1,modelValue:p.value,"onUpdate:modelValue":e[7]||(e[7]=o=>p.value=o),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:o})=>[a(w,C({modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=s=>g.value=s),label:"Due Date (Weekly) *","prepend-inner-icon":"mdi-calendar",readonly:"",variant:"outlined",density:"comfortable"},o,{"error-messages":r(l).errors.due_date,hint:"Select specific date","persistent-hint":""}),null,16,["modelValue","error-messages"])]),default:t(()=>[a(S,{modelValue:f.value,"onUpdate:modelValue":[e[6]||(e[6]=o=>f.value=o),A]},null,8,["modelValue"])]),_:1},8,["modelValue"])):c.value?.payment_frequency==="monthly"?(v(),_(x,{key:2,modelValue:p.value,"onUpdate:modelValue":e[10]||(e[10]=o=>p.value=o),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:o})=>[a(w,C({modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=s=>g.value=s),label:"Due Date (Monthly - 1st of month) *","prepend-inner-icon":"mdi-calendar-month",readonly:"",variant:"outlined",density:"comfortable"},o,{"error-messages":r(l).errors.due_date,hint:"Automatically set to 1st of selected month","persistent-hint":""}),null,16,["modelValue","error-messages"])]),default:t(()=>[a(S,{modelValue:f.value,"onUpdate:modelValue":[e[9]||(e[9]=o=>f.value=o),z]},null,8,["modelValue"])]),_:1},8,["modelValue"])):c.value?.payment_frequency==="yearly"?(v(),_(x,{key:3,modelValue:p.value,"onUpdate:modelValue":e[13]||(e[13]=o=>p.value=o),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:o})=>[a(w,C({modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=s=>g.value=s),label:"Due Date (Yearly - Jan 1st) *","prepend-inner-icon":"mdi-calendar-blank",readonly:"",variant:"outlined",density:"comfortable"},o,{"error-messages":r(l).errors.due_date,hint:"Automatically set to January 1st of selected year","persistent-hint":""}),null,16,["modelValue","error-messages"])]),default:t(()=>[a(S,{modelValue:f.value,"onUpdate:modelValue":[e[12]||(e[12]=o=>f.value=o),B]},null,8,["modelValue"])]),_:1},8,["modelValue"])):(v(),_(w,{key:4,modelValue:r(l).due_date,"onUpdate:modelValue":e[14]||(e[14]=o=>r(l).due_date=o),label:"Due Date *",type:"date",variant:"outlined",density:"comfortable","error-messages":r(l).errors.due_date,hint:"Select a property first","persistent-hint":"",disabled:""},null,8,["modelValue","error-messages"]))]),_:1}),a(m,{cols:"12"},{default:t(()=>[a(T,{modelValue:r(l).description,"onUpdate:modelValue":e[15]||(e[15]=o=>r(l).description=o),label:"Description",variant:"outlined",density:"comfortable",rows:"3","error-messages":r(l).errors.description},null,8,["modelValue","error-messages"])]),_:1}),a(m,{cols:"12"},{default:t(()=>[a(P,{variant:"outlined",color:"blue-lighten-5"},{default:t(()=>[a(V,{class:"text-subtitle-1"},{default:t(()=>[a(O,{icon:"mdi-bank",class:"mr-2"}),e[21]||(e[21]=k(" GIRAS Payment Gateway Integration ",-1))]),_:1}),a(D,null,{default:t(()=>[a(U,null,{default:t(()=>[a(m,{cols:"12",md:"6"},{default:t(()=>[a(J,{modelValue:r(l).sync_with_giras,"onUpdate:modelValue":e[16]||(e[16]=o=>r(l).sync_with_giras=o),label:"Sync with GIRAS Payment Gateway",color:"primary",hint:"Enable to generate payment link through GIRAS","persistent-hint":"",inset:""},null,8,["modelValue"])]),_:1}),r(l).sync_with_giras?(v(),_(m,{key:0,cols:"12",md:"6"},{default:t(()=>[a(K,{modelValue:r(l).giras_gateway,"onUpdate:modelValue":e[17]||(e[17]=o=>r(l).giras_gateway=o),label:"Payment Gateway",items:["paystack","remita","interswitch"],variant:"outlined",density:"comfortable",hint:"Select payment gateway for GIRAS","persistent-hint":""},null,8,["modelValue"])]),_:1})):G("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),c.value?(v(),_(m,{key:0,cols:"12"},{default:t(()=>[a(P,{variant:"outlined",color:"grey-lighten-4"},{default:t(()=>[a(V,{class:"text-subtitle-1"},{default:t(()=>[...e[22]||(e[22]=[k(" Customer Information ",-1)])]),_:1}),a(D,null,{default:t(()=>[a(U,null,{default:t(()=>[a(m,{cols:"12",md:"4"},{default:t(()=>[e[23]||(e[23]=y("div",{class:"text-caption text-grey"},"Customer Name",-1)),y("div",se,b(c.value.customer.name),1)]),_:1}),a(m,{cols:"12",md:"4"},{default:t(()=>[e[24]||(e[24]=y("div",{class:"text-caption text-grey"},"Property Type",-1)),y("div",ie,b(c.value.property_type),1)]),_:1}),a(m,{cols:"12",md:"4"},{default:t(()=>[e[25]||(e[25]=y("div",{class:"text-caption text-grey"},"Payment Frequency",-1)),y("div",ue,b(c.value.payment_frequency),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):G("",!0),a(m,{cols:"12"},{default:t(()=>[a(u,{type:"submit",color:"primary",size:"large",loading:r(l).processing,disabled:r(l).processing},{default:t(()=>[...e[26]||(e[26]=[k(" Create Invoice ",-1)])]),_:1},8,["loading","disabled"]),a(u,{variant:"text",size:"large",class:"ml-2",onClick:e[18]||(e[18]=o=>n.$inertia.visit(n.route("admin.invoices.index")))},{default:t(()=>[...e[27]||(e[27]=[k(" Cancel ",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}});export{ce as default};
